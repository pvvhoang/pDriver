---
output:
  html_document:
    df_print: paged
  pdf_document: default
---

# pDriver: A novel method for unravelling personalised coding and miNRA cancer drivers

Vu VH Pham^1^, Lin Liu^1^, Cameron P Bracken^2,3^, Gregory J Goodall^2,3^, Thin Nguyen^4^, Jiuyong Li^1^, and Thuc D Le^1^

^1^ School of Information Technology and Mathematical Sciences, University of South Australia, Mawson Lakes, SA 5095, Australia

^2^ Centre for Cancer Biology, an alliance of SA Pathology and University of South Australia, Adelaide, SA 5000, Australia

^3^ Department of Medicine, The University of Adelaide, Adelaide, SA 5005, Australia 

^4^ Applied Artificial Intelligence Institute, Deakin University, Australia \newline \newline \newline

This is the script to run the proposed method. Please remember to include the script of functions from the file PersonalisedDriverFunctions.R to run this script.

## The script

This is the script of the proposed method in identifying personalised cancer drivers.

To run the script, please prepare below input files and reset environment variables in the script.

The input files include the followings and are put in the folder "rootDir/Data" (rootDir is an environment variable):

* PPI.xls - Protein protein interaction network

* Browse Transcription Factors hg19 - resource_browser.csv - Transcription factors (TFs)

* hsa.tsv - TransmiR dataset for TF-miRNA interactions

* miRTarBase_v6.1+TarBase_v7.0+miRWalk_v2.0.csv - Datasets for miRNA-mRNA and miRNA-TF interactions

* TargetScan_7.0.csv - Dataset for miRNA-mRNA and miRNA-TF interactions

* BRCA_matchedData_full.RData - Tumour expression data

```{r, message=FALSE, warning=FALSE, eval=FALSE}
#=========================================================================
#=========================================================================
# pDriver: A novel method for unravelling personalised coding and non-coding cancer drivers
#=========================================================================
#=========================================================================
# Clear the environment
rm(list = ls())

# Load necessary libraries if any
library(readxl)
library(miRLAB)
library(miRBaseConverter)
library(ggplot2)
library(varhandle)
library(scales)
library(reshape)
library(plyr)
library(RColorBrewer)
library(tidyverse)
library(xtable)
library(arrangements)
library(biomaRt)
library(foreach)
library(doParallel)
library(pcalg)
library(ParallelPC)
library(CancerSubtypes)
library(survcomp)
library(Biobase)
library(mlr)
library(randomForestSRC)
library(Hmisc)
library(survival)
library(NMF)
library(cluster)
library(wesanderson)
library(lionessR)
library(data.table)
library(igraph)

#---------------------------------------
# Set environment variables if any
# Please remember to create necessary folders
rootDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment" # And put the input files
  # in "rootDir/Data"
outDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment/Data/Output" # Output folder
controlDir <- "C:/MinGW/bin" # Put here the library from control network
numCores <- 4 # Number of cores to be used
nomiR <- 100 # Can be set by users, this is the number of selected miRNAs for further analysis
nomR <- 100 # Can be set by users, this is the number of selected coding genes for further analysis besides TFs
nomRforSC <- 400
#---------------------------------------

# Include the script of functions
source(paste(rootDir, "/Script/PersonalisedDriverFunctions.R", sep=""))
source(paste(rootDir, "/Script/Prognosis.R", sep=""))

# Main script
#================================================================
# (1) Constructing the miRNA-TF-mRNA network for cancer patients
#================================================================
#---------------------------------------
# Common
#---------------------------------------
# load the dataset
# Load the tumor expression data
load(paste(rootDir, "/Data/BRCA_matchedData_full.RData", sep = "")) # rows - samples, cols - genes

# Get PPI network
edges <- read_excel(paste(rootDir, "/Data/PPI.xls",
                          sep = ""), sheet = 1)
interactions <- edges[, c(1, 3)]
colnames(interactions) <- c("cause", "effect")
interactions <- interactions[which(interactions$cause %in% colnames(BRCA_matchedData$mRNAs)),]
interactions <- interactions[which(interactions$effect %in% colnames(BRCA_matchedData$mRNAs)),]
nodes <- unique(union(interactions$cause, interactions$effect))

# TFs: Download the list from http://fantom.gsc.riken.jp/5/sstar/Browse_Transcription_Factors_hg19
tfs <- read.csv(paste(rootDir, "/Data/Browse Transcription Factors hg19 - resource_browser.csv",
                      sep = ""))
i <- which(levels(tfs$Symbol) %in% nodes)
tfData <- BRCA_matchedData$mRNAs[, levels(tfs$Symbol)[i]]

# Update cancer data of mRNAs
mRNAsData_Cancer <- BRCA_matchedData$mRNAs[,
  nodes[which(!(nodes %in% levels(tfs$Symbol)[i]))]]

# Get the cancer data of miRNAs
miRNAsData_Cancer <-  BRCA_matchedData$miRs

# Select genes
miRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(miRNAsData_Cancer), nomiR))
mRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(mRNAsData_Cancer),nomR))

# Covert miRNAs
colnames(miRNAsData_Cancer) <- miRNAVersionConvert(colnames(miRNAsData_Cancer),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]

# Combine data
noTF <- ncol(tfData)
cancer_data <- cbind(miRNAsData_Cancer, mRNAsData_Cancer, tfData)

# change to: rows - genes, cols - samples
cancer_data <- t(cancer_data)

# Free the memory
gc()

#---------------------------------------
# (1.1) LIONESS
#---------------------------------------
# construct network
cancer_network_LIONESS <- constructNetwork(cancer_data, method="LIONESS", rootDir)

# Save the network
fwrite(cancer_network_LIONESS, paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), row.names = FALSE)

#---------------------------------------
# Common (Just run 1 time)
#---------------------------------------
# Compute node weight
load(paste(rootDir, "/Data/BRCA_matchedData_normal_samples_full.RData", sep = "")) # rows - samples, cols - genes
miRNAsData_Normal <- BRCA_matchedData_normal_samples$miRs
# Covert miRNAs
colnames(miRNAsData_Normal) <- miRNAVersionConvert(colnames(miRNAsData_Normal),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]
miRNAsData_Normal <-  miRNAsData_Normal[, colnames(miRNAsData_Cancer)]
mRNAsData_Normal <- BRCA_matchedData_normal_samples$mRNAs[, colnames(mRNAsData_Cancer)]
tfData_Normal <- BRCA_matchedData_normal_samples$mRNAs[, colnames(tfData)]
normal_data <- cbind(miRNAsData_Normal, mRNAsData_Normal, tfData_Normal)
nodeList <- computeNodeWeight(t(cancer_data), normal_data)
# Save file
write.csv(nodeList, paste(outDir, "/nodeList.csv", sep = ""), row.names = TRUE)

#================================================================
# (2) Identifying cancer drivers
#================================================================

#---------------------------------------
# (2.1) LIONESS - control
#---------------------------------------
network <- read.csv(paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), as.is = TRUE)
nodes <- read.csv(paste(outDir, "/nodeList.csv", sep = ""), as.is = TRUE)
drivers <- identifyDrivers(network, nodes, method="control", outDir, controlDir)
# Save drivers
drivers <- as.data.table(drivers)
fwrite(drivers, paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), row.names = FALSE)

#---------------------------------------
# (2.2) LIONESS - Maximisation Influence (MI)
#---------------------------------------
network <- read.csv(paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), as.is = TRUE)
nodes <- read.csv(paste(outDir, "/nodeList.csv", sep = ""), as.is = TRUE)
# drivers <- identifyDrivers(network, nodes, method="MI", outDir, controlDir)
# ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 
# From identifyDrivers function
drivers <- nodes[,1]
drivers <- as.matrix(drivers, ncol=1)
colnames(drivers) <- "Gene"
for (i in 3:ncol(network)) {
  # temp <- identifyIndDriversbyMI(network[,c(1:2, i)], nodes, outDir)
  # From identifyIndDriversbyMI function
  net <- network[,c(1:2, i)]
  temp <- nodes
  
  # Influence of active sets
  activeSets <- unique(union(net$reg, net$tar))
  n_activeSets <- length(activeSets)
  inf <- matrix(nrow = n_activeSets, ncol = 2)
  colnames(inf) <- c("Gene", "Influence")
  
  # Normalise node weight so that it is in [0,1]
  maxNodeWeight <- max(abs(nodes[,2]))
  nodes[,2] <- nodes[,2]/maxNodeWeight
  
  # Normalise edge weight
  colnames(net)[1:2] <- c("cause", "effect")
  net <- normaliseEdgeWeight(net)
  
  # Evaluate influence
  registerDoParallel(4)  # Use multi cores, set to the number of cores
  geneData <- activeSets
  geneData <- matrix(geneData, ncol = 1)
  r <- foreach (j=1:n_activeSets, .combine = c) %dopar% {
    evaluateInfluence(activeSets[j], geneData, net, nodes)
  }
  for (j in 1:n_activeSets) {
    inf[j,1] <- activeSets[j]
    inf[j,2] <- r[j]
  }
  stopImplicitCluster() # Clean up the cluster
  
  # output
  subDir <- gsub(".", "-", colnames(net)[3], fixed = TRUE)
  l <- nrow(temp)
  for (j in 1:l) {
    ind <- which(inf[,1] == temp[j,1])
    if(!is_empty(ind)) {
      v <- inf[ind,2]
    } else {
      v <- 0
    }
    temp[j,2] <- v
  }
  colnames(temp) <- c("Gene", subDir)
  # End identifyIndDriversbyMI function
  
  drivers <- cbind(drivers, temp[,2])
  colnames(drivers)[i-1] <- colnames(temp)[2]
}
# End identifyDrivers function
# ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 
# Save drivers
drivers <- as.data.table(drivers)
fwrite(drivers, paste(outDir, "/drivers_LIONESS_MI.csv", sep = ""), row.names = FALSE)

#---------------------------------------
# (2.3) LIONESS - PageRank
#---------------------------------------
network <- read.csv(paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), as.is = TRUE)
nodes <- read.csv(paste(outDir, "/nodeList.csv", sep = ""), as.is = TRUE)
drivers <- identifyDrivers(network, nodes, method="PageRank", outDir, controlDir)
# Save drivers
drivers <- as.data.table(drivers)
fwrite(drivers, paste(outDir, "/drivers_LIONESS_PageRank.csv", sep = ""), row.names = FALSE)

#================================================================
# (3) Aggregate
#================================================================

#---------------------------------------
# (3.1) LIONESS - control
#---------------------------------------
drivers <- read.csv(paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), as.is = TRUE)
totalDrivers <- cbind(drivers[,1], 0)
totalDrivers[,2] <- rowSums(drivers[,2:ncol(drivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
noncodingDrivers <- totalDrivers[1:nomiR,]
noncodingDrivers <- noncodingDrivers[which(noncodingDrivers[,2] > 0),]
noncodingDrivers <- noncodingDrivers[order(noncodingDrivers[,2], decreasing = TRUE),]
codingDrivers <- totalDrivers[(nomiR+1):nrow(drivers),]
codingDrivers <- codingDrivers[which(codingDrivers[,2] > 0),]
codingDrivers <- codingDrivers[order(codingDrivers[,2], decreasing = TRUE),]
# Save drivers
noncodingDrivers <- as.data.table(noncodingDrivers)
fwrite(noncodingDrivers, paste(outDir, "/noncodingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)
codingDrivers <- as.data.table(codingDrivers)
fwrite(codingDrivers, paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)

#---------------------------------------
# (3.2) LIONESS - MI
#---------------------------------------
drivers <- read.csv(paste(outDir, "/drivers_LIONESS_MI.csv", sep = ""), as.is = TRUE)

# Noncoding
ndrivers <- selectTopDrivers(drivers[1:nomiR,], 20)
totalDrivers <- cbind(ndrivers[,1], 0)
totalDrivers[,2] <- rowSums(ndrivers[,2:ncol(ndrivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
noncodingDrivers <- totalDrivers
noncodingDrivers <- noncodingDrivers[which(noncodingDrivers[,2] > 0),]
noncodingDrivers <- noncodingDrivers[order(noncodingDrivers[,2], decreasing = TRUE),]

# Coding
cdrivers <- selectTopDrivers(drivers[(nomiR+1):nrow(drivers),], 200)
totalDrivers <- cbind(cdrivers[,1], 0)
totalDrivers[,2] <- rowSums(cdrivers[,2:ncol(cdrivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
codingDrivers <- totalDrivers
codingDrivers <- codingDrivers[which(codingDrivers[,2] > 0),]
codingDrivers <- codingDrivers[order(codingDrivers[,2], decreasing = TRUE),]

# Save drivers
noncodingDrivers <- as.data.table(noncodingDrivers)
fwrite(noncodingDrivers, paste(outDir, "/noncodingGeneralDrivers_LIONESS_MI.csv", sep = ""),
       row.names = FALSE)
codingDrivers <- as.data.table(codingDrivers)
fwrite(codingDrivers, paste(outDir, "/codingGeneralDrivers_LIONESS_MI.csv", sep = ""),
       row.names = FALSE)

#---------------------------------------
# (3.3) LIONESS - PageRank
#---------------------------------------
drivers <- read.csv(paste(outDir, "/drivers_LIONESS_PageRank.csv", sep = ""), as.is = TRUE)

# Noncoding
ndrivers <- selectTopDrivers(drivers[1:nomiR,], 20)
totalDrivers <- cbind(ndrivers[,1], 0)
totalDrivers[,2] <- rowSums(ndrivers[,2:ncol(ndrivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
noncodingDrivers <- totalDrivers
noncodingDrivers <- noncodingDrivers[which(noncodingDrivers[,2] > 0),]
noncodingDrivers <- noncodingDrivers[order(noncodingDrivers[,2], decreasing = TRUE),]

# Coding
cdrivers <- selectTopDrivers(drivers[(nomiR+1):nrow(drivers),], 200)
totalDrivers <- cbind(cdrivers[,1], 0)
totalDrivers[,2] <- rowSums(cdrivers[,2:ncol(cdrivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
codingDrivers <- totalDrivers
codingDrivers <- codingDrivers[which(codingDrivers[,2] > 0),]
codingDrivers <- codingDrivers[order(codingDrivers[,2], decreasing = TRUE),]

# Save drivers
noncodingDrivers <- as.data.table(noncodingDrivers)
fwrite(noncodingDrivers, paste(outDir, "/noncodingGeneralDrivers_LIONESS_PageRank.csv", sep = ""),
       row.names = FALSE)
codingDrivers <- as.data.table(codingDrivers)
fwrite(codingDrivers, paste(outDir, "/codingGeneralDrivers_LIONESS_PageRank.csv", sep = ""),
       row.names = FALSE)

#================================================================
# (4) Validate
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)

#---------------------------------------
# (4.1) LIONESS - control
#---------------------------------------
# pDriver
pDriver_drivers = read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
pDriver_Top50 <- pDriver_drivers[1:50,]
pDriver_Top100 <- pDriver_drivers[1:100,]
pDriver_Top150 <- pDriver_drivers[1:150,]
pDriver_Top200 <- pDriver_drivers[1:200,]
pDriver_Top50_Validated <- intersect(pDriver_Top50[, "V1"], gold_standard)
pDriver_Top100_Validated <- intersect(pDriver_Top100[, "V1"], gold_standard)
pDriver_Top150_Validated <- intersect(pDriver_Top150[, "V1"], gold_standard)
pDriver_Top200_Validated <- intersect(pDriver_Top200[, "V1"], gold_standard)

#================================================================
# (5) Compare
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)
noOfCGC <- length(gold_standard)


#---------------------------------------
# BRCA
#---------------------------------------
# Result
ind <- 0
r <- matrix(0, nrow = 13, ncol = 3)
row.names(r) <- c("PNC", "DriverML", "ActiveDriver", "DriverNet", "MutSigCV",
                  "OncoDriveFM", "DEG-Folchange", "DEG-p-value", "DEG-FDR", "Hub-genes",
                  "DawnRank", "SSN", "pDriver")
colnames(r) <- c("Precision", "Recall", "F1Score")

# Set cancer type
cancer_type <- 1 # BRCA, column 1

# PNC
# Set method
method <- 1 # PNC, sheet 1
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverML
# Set method
method <- 2 # DriverML, sheet 2
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# ActiveDriver
# Set method
method <- 3 # ActiveDriver, sheet 3
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverNet
# Set method
method <- 4 # DriverNet, sheet 4
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(NA, NA, NA) # Because the number of estimated drivers is too small, we remove this out of the comparison

# MutSigCV
# Set method
method <- 5 # MutSigCV, sheet 5
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# OncoDriveFM
# Set method
method <- 6 # OncoDriveFM, sheet 6
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-Folchange
# Set method
method <- 7 # DEG-Folchange, sheet 7
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-p-value
# Set method
method <- 8 # DEG-p-value, sheet 8
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-FDR
# Set method
method <- 9 # DEG-FDR, sheet 9
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# Hub-genes
# Set method
method <- 10 # Hub-genes, sheet 10
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DawnRank
# Set method
method <- 12 # DawnRank, sheet 12
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# SSN
# Set method
method <- 13 # SSN, sheet 13
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# pDriver
driver <- read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
driver <- as.character(driver[,1])
driver_validated <- intersect(driver, gold_standard)
t <- computeMeasures(length(driver_validated), length(driver) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

```

## The script for LUAD

```{r, message=FALSE, warning=FALSE, eval=FALSE}
#=========================================================================
#=========================================================================
# pDriver: A novel method for unravelling personalised coding and non-coding cancer drivers
#=========================================================================
#=========================================================================
# Clear the environment
rm(list = ls())

# Load necessary libraries if any
library(readxl)
library(miRLAB)
library(miRBaseConverter)
library(ggplot2)
library(varhandle)
library(scales)
library(reshape)
library(plyr)
library(RColorBrewer)
library(tidyverse)
library(xtable)
library(arrangements)
library(biomaRt)
library(foreach)
library(doParallel)
library(pcalg)
library(ParallelPC)
library(CancerSubtypes)
library(survcomp)
library(Biobase)
library(mlr)
library(randomForestSRC)
library(Hmisc)
library(survival)
library(NMF)
library(cluster)
library(wesanderson)
library(lionessR)
library(data.table)
library(igraph)

#---------------------------------------
# Set environment variables if any
# Please remember to create necessary folders
rootDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment" # And put the input files
  # in "rootDir/Data"
outDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment/Data/LUAD" # Output folder
controlDir <- "C:/MinGW/bin" # Put here the library from control network
numCores <- 4 # Number of cores to be used
nomiR <- 100
nomR <- 100
#---------------------------------------

# Include the script of functions
source(paste(rootDir, "/Script/PersonalisedDriverFunctions.R", sep=""))
source(paste(rootDir, "/Script/Prognosis.R", sep=""))

# Main script
#================================================================
# (1) Constructing the miRNA-TF-mRNA network for cancer patients
#================================================================
#---------------------------------------
# Common
#---------------------------------------
# load the dataset
# Load the tumor expression data
#---------------------------------------
load(paste(rootDir, "/Data/LUAD_matchedData_full.RData", sep = "")) # rows - samples, cols - genes
matchedData <- LUAD_matchedData
#---------------------------------------

# Get PPI network
edges <- read_excel(paste(rootDir, "/Data/PPI.xls",
                          sep = ""), sheet = 1)
interactions <- edges[, c(1, 3)]
colnames(interactions) <- c("cause", "effect")
interactions <- interactions[which(interactions$cause %in% colnames(matchedData$mRNAs)),]
interactions <- interactions[which(interactions$effect %in% colnames(matchedData$mRNAs)),]
nodes <- unique(union(interactions$cause, interactions$effect))

# TFs: Download the list from http://fantom.gsc.riken.jp/5/sstar/Browse_Transcription_Factors_hg19
tfs <- read.csv(paste(rootDir, "/Data/Browse Transcription Factors hg19 - resource_browser.csv",
                      sep = ""))
i <- which(levels(tfs$Symbol) %in% nodes)
tfData <- matchedData$mRNAs[, levels(tfs$Symbol)[i]]

# Update cancer data of mRNAs
mRNAsData_Cancer <- matchedData$mRNAs[,
  nodes[which(!(nodes %in% levels(tfs$Symbol)[i]))]]

# Get the cancer data of miRNAs
miRNAsData_Cancer <-  matchedData$miRs

# Select genes
miRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(miRNAsData_Cancer), nomiR))
mRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(mRNAsData_Cancer),nomR))

# Covert miRNAs
colnames(miRNAsData_Cancer) <- miRNAVersionConvert(colnames(miRNAsData_Cancer),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]

# Combine data
noTF <- ncol(tfData)
cancer_data <- cbind(miRNAsData_Cancer, mRNAsData_Cancer, tfData)

# change to: rows - genes, cols - samples
cancer_data <- t(cancer_data)

# Free the memory
gc()

#---------------------------------------
# (1.1) LIONESS
#---------------------------------------
# construct network
cancer_network_LIONESS <- constructNetwork(cancer_data, method="LIONESS", rootDir)

# Save the network
fwrite(cancer_network_LIONESS, paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), row.names = FALSE)

#---------------------------------------
# Common (Just run 1 time)
#---------------------------------------
# Compute node weight
#---------------------------------------
load(paste(rootDir, "/Data/LUAD_matchedData_normal_samples_full.RData", sep = "")) # rows - samples, cols - genes
matchedData_normal_samples <- LUAD_matchedData_normal_samples
#---------------------------------------
miRNAsData_Normal <- matchedData_normal_samples$miRs
# Covert miRNAs
colnames(miRNAsData_Normal) <- miRNAVersionConvert(colnames(miRNAsData_Normal),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]
miRNAsData_Normal <-  miRNAsData_Normal[, colnames(miRNAsData_Cancer)]
mRNAsData_Normal <- matchedData_normal_samples$mRNAs[, colnames(mRNAsData_Cancer)]
tfData_Normal <- matchedData_normal_samples$mRNAs[, colnames(tfData)]
normal_data <- cbind(miRNAsData_Normal, mRNAsData_Normal, tfData_Normal)
nodeList <- computeNodeWeight(t(cancer_data), normal_data)
# Save file
write.csv(nodeList, paste(outDir, "/nodeList.csv", sep = ""), row.names = TRUE)

#================================================================
# (2) Identifying cancer drivers
#================================================================

#---------------------------------------
# (2.1) LIONESS - control
#---------------------------------------
network <- read.csv(paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), as.is = TRUE)
nodes <- read.csv(paste(outDir, "/nodeList.csv", sep = ""), as.is = TRUE)
drivers <- identifyDrivers(network, nodes, method="control", outDir, controlDir)
# Save drivers
drivers <- as.data.table(drivers)
fwrite(drivers, paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), row.names = FALSE)

#================================================================
# (3) Aggregate
#================================================================

#---------------------------------------
# (3.1) LIONESS - control
#---------------------------------------
drivers <- read.csv(paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), as.is = TRUE)
totalDrivers <- cbind(drivers[,1], 0)
totalDrivers[,2] <- rowSums(drivers[,2:ncol(drivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
noncodingDrivers <- totalDrivers[1:nomiR,]
noncodingDrivers <- noncodingDrivers[which(noncodingDrivers[,2] > 0),]
noncodingDrivers <- noncodingDrivers[order(noncodingDrivers[,2], decreasing = TRUE),]
codingDrivers <- totalDrivers[(nomiR+1):nrow(drivers),]
codingDrivers <- codingDrivers[which(codingDrivers[,2] > 0),]
codingDrivers <- codingDrivers[order(codingDrivers[,2], decreasing = TRUE),]
# Save drivers
noncodingDrivers <- as.data.table(noncodingDrivers)
fwrite(noncodingDrivers, paste(outDir, "/noncodingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)
codingDrivers <- as.data.table(codingDrivers)
fwrite(codingDrivers, paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)

#================================================================
# (4) Validate
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)

#---------------------------------------
# (4.1) LIONESS - control
#---------------------------------------
# pDriver
pDriver_drivers = read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
pDriver_Top50 <- pDriver_drivers[1:50,]
pDriver_Top100 <- pDriver_drivers[1:100,]
pDriver_Top150 <- pDriver_drivers[1:150,]
pDriver_Top200 <- pDriver_drivers[1:200,]
pDriver_Top50_Validated <- intersect(pDriver_Top50[, "V1"], gold_standard)
pDriver_Top100_Validated <- intersect(pDriver_Top100[, "V1"], gold_standard)
pDriver_Top150_Validated <- intersect(pDriver_Top150[, "V1"], gold_standard)
pDriver_Top200_Validated <- intersect(pDriver_Top200[, "V1"], gold_standard)

#================================================================
# (5) Compare
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)
noOfCGC <- length(gold_standard)

#---------------------------------------
# LUAD
#---------------------------------------
# Result
ind <- 0
#---------------------------------------
r <- matrix(0, nrow = 14, ncol = 3)
row.names(r) <- c("PNC", "DriverML", "ActiveDriver", "DriverNet", "MutSigCV",
                  "OncoDriveFM", "DEG-Folchange", "DEG-p-value", "DEG-FDR", "Hub-genes",
                  "SCS", "DawnRank", "SSN", "pDriver")
colnames(r) <- c("Precision", "Recall", "F1Score")

# Set cancer type
cancer_type <- 3 # LUAD, column 3
#---------------------------------------

# PNC
# Set method
method <- 1 # PNC, sheet 1
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverML
# Set method
method <- 2 # DriverML, sheet 2
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# ActiveDriver
# Set method
method <- 3 # ActiveDriver, sheet 3
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverNet
# Set method
method <- 4 # DriverNet, sheet 4
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(NA, NA, NA) # Because the number of estimated drivers is too small, we remove this out of the comparison

# MutSigCV
# Set method
method <- 5 # MutSigCV, sheet 5
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# OncoDriveFM
# Set method
method <- 6 # OncoDriveFM, sheet 6
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-Folchange
# Set method
method <- 7 # DEG-Folchange, sheet 7
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-p-value
# Set method
method <- 8 # DEG-p-value, sheet 8
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-FDR
# Set method
method <- 9 # DEG-FDR, sheet 9
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# Hub-genes
# Set method
method <- 10 # Hub-genes, sheet 10
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# SCS
# Set method
method <- 11 # SCS, sheet 11
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DawnRank
# Set method
method <- 12 # DawnRank, sheet 12
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# SSN
# Set method
method <- 13 # SSN, sheet 13
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# pDriver
driver <- read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
driver <- as.character(driver[,1])
driver_validated <- intersect(driver, gold_standard)
t <- computeMeasures(length(driver_validated), length(driver) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

```

## The script for LUSC

```{r, message=FALSE, warning=FALSE, eval=FALSE}
#=========================================================================
#=========================================================================
# pDriver: A novel method for unravelling personalised coding and non-coding cancer drivers
#=========================================================================
#=========================================================================
# Clear the environment
rm(list = ls())

# Load necessary libraries if any
library(readxl)
library(miRLAB)
library(miRBaseConverter)
library(ggplot2)
library(varhandle)
library(scales)
library(reshape)
library(plyr)
library(RColorBrewer)
library(tidyverse)
library(xtable)
library(arrangements)
library(biomaRt)
library(foreach)
library(doParallel)
library(pcalg)
library(ParallelPC)
library(CancerSubtypes)
library(survcomp)
library(Biobase)
library(mlr)
library(randomForestSRC)
library(Hmisc)
library(survival)
library(NMF)
library(cluster)
library(wesanderson)
library(lionessR)
library(data.table)
library(igraph)

#---------------------------------------
# Set environment variables if any
# Please remember to create necessary folders
rootDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment" # And put the input files
  # in "rootDir/Data"
outDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment/Data/LUSC" # Output folder
controlDir <- "C:/MinGW/bin" # Put here the library from control network
numCores <- 4 # Number of cores to be used
nomiR <- 100
nomR <- 100
#---------------------------------------

# Include the script of functions
source(paste(rootDir, "/Script/PersonalisedDriverFunctions.R", sep=""))
source(paste(rootDir, "/Script/Prognosis.R", sep=""))

# Main script
#================================================================
# (1) Constructing the miRNA-TF-mRNA network for cancer patients
#================================================================
#---------------------------------------
# Common
#---------------------------------------
# load the dataset
# Load the tumor expression data
#---------------------------------------
load(paste(rootDir, "/Data/LUSC_matchedData_full.RData", sep = "")) # rows - samples, cols - genes
matchedData <- LUSC_matchedData
#---------------------------------------

# Get PPI network
edges <- read_excel(paste(rootDir, "/Data/PPI.xls",
                          sep = ""), sheet = 1)
interactions <- edges[, c(1, 3)]
colnames(interactions) <- c("cause", "effect")
interactions <- interactions[which(interactions$cause %in% colnames(matchedData$mRNAs)),]
interactions <- interactions[which(interactions$effect %in% colnames(matchedData$mRNAs)),]
nodes <- unique(union(interactions$cause, interactions$effect))

# TFs: Download the list from http://fantom.gsc.riken.jp/5/sstar/Browse_Transcription_Factors_hg19
tfs <- read.csv(paste(rootDir, "/Data/Browse Transcription Factors hg19 - resource_browser.csv",
                      sep = ""))
i <- which(levels(tfs$Symbol) %in% nodes)
tfData <- matchedData$mRNAs[, levels(tfs$Symbol)[i]]

# Update cancer data of mRNAs
mRNAsData_Cancer <- matchedData$mRNAs[,
  nodes[which(!(nodes %in% levels(tfs$Symbol)[i]))]]

# Get the cancer data of miRNAs
miRNAsData_Cancer <-  matchedData$miRs

# Select genes
miRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(miRNAsData_Cancer), nomiR))
mRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(mRNAsData_Cancer),nomR))

# Covert miRNAs
colnames(miRNAsData_Cancer) <- miRNAVersionConvert(colnames(miRNAsData_Cancer),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]

# Combine data
noTF <- ncol(tfData)
cancer_data <- cbind(miRNAsData_Cancer, mRNAsData_Cancer, tfData)

# change to: rows - genes, cols - samples
cancer_data <- t(cancer_data)

# Free the memory
gc()

#---------------------------------------
# (1.1) LIONESS
#---------------------------------------
# construct network
cancer_network_LIONESS <- constructNetwork(cancer_data, method="LIONESS", rootDir)

# Save the network
fwrite(cancer_network_LIONESS, paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), row.names = FALSE)

#---------------------------------------
# Common (Just run 1 time)
#---------------------------------------
# Compute node weight
#---------------------------------------
load(paste(rootDir, "/Data/LUSC_matchedData_normal_samples_full.RData", sep = "")) # rows - samples, cols - genes
matchedData_normal_samples <- LUSC_matchedData_normal_samples
#---------------------------------------
miRNAsData_Normal <- matchedData_normal_samples$miRs
# Covert miRNAs
colnames(miRNAsData_Normal) <- miRNAVersionConvert(colnames(miRNAsData_Normal),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]
miRNAsData_Normal <-  miRNAsData_Normal[, colnames(miRNAsData_Cancer)]
mRNAsData_Normal <- matchedData_normal_samples$mRNAs[, colnames(mRNAsData_Cancer)]
tfData_Normal <- matchedData_normal_samples$mRNAs[, colnames(tfData)]
normal_data <- cbind(miRNAsData_Normal, mRNAsData_Normal, tfData_Normal)
nodeList <- computeNodeWeight(t(cancer_data), normal_data)
# Save file
write.csv(nodeList, paste(outDir, "/nodeList.csv", sep = ""), row.names = TRUE)

#================================================================
# (2) Identifying cancer drivers
#================================================================

#---------------------------------------
# (2.1) LIONESS - control
#---------------------------------------
network <- read.csv(paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), as.is = TRUE)
nodes <- read.csv(paste(outDir, "/nodeList.csv", sep = ""), as.is = TRUE)
drivers <- identifyDrivers(network, nodes, method="control", outDir, controlDir)
# Save drivers
drivers <- as.data.table(drivers)
fwrite(drivers, paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), row.names = FALSE)

#================================================================
# (3) Aggregate
#================================================================

#---------------------------------------
# (3.1) LIONESS - control
#---------------------------------------
drivers <- read.csv(paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), as.is = TRUE)
totalDrivers <- cbind(drivers[,1], 0)
totalDrivers[,2] <- rowSums(drivers[,2:ncol(drivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
noncodingDrivers <- totalDrivers[1:nomiR,]
noncodingDrivers <- noncodingDrivers[which(noncodingDrivers[,2] > 0),]
noncodingDrivers <- noncodingDrivers[order(noncodingDrivers[,2], decreasing = TRUE),]
codingDrivers <- totalDrivers[(nomiR+1):nrow(drivers),]
codingDrivers <- codingDrivers[which(codingDrivers[,2] > 0),]
codingDrivers <- codingDrivers[order(codingDrivers[,2], decreasing = TRUE),]
# Save drivers
noncodingDrivers <- as.data.table(noncodingDrivers)
fwrite(noncodingDrivers, paste(outDir, "/noncodingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)
codingDrivers <- as.data.table(codingDrivers)
fwrite(codingDrivers, paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)

#================================================================
# (4) Validate
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)

#---------------------------------------
# (4.1) LIONESS - control
#---------------------------------------
# pDriver
pDriver_drivers = read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
pDriver_Top50 <- pDriver_drivers[1:50,]
pDriver_Top100 <- pDriver_drivers[1:100,]
pDriver_Top150 <- pDriver_drivers[1:150,]
pDriver_Top200 <- pDriver_drivers[1:200,]
pDriver_Top50_Validated <- intersect(pDriver_Top50[, "V1"], gold_standard)
pDriver_Top100_Validated <- intersect(pDriver_Top100[, "V1"], gold_standard)
pDriver_Top150_Validated <- intersect(pDriver_Top150[, "V1"], gold_standard)
pDriver_Top200_Validated <- intersect(pDriver_Top200[, "V1"], gold_standard)

#================================================================
# (5) Compare
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)
noOfCGC <- length(gold_standard)

#---------------------------------------
# LUSC
#---------------------------------------
# Result
ind <- 0
#---------------------------------------
r <- matrix(0, nrow = 12, ncol = 3)
row.names(r) <- c("PNC", "DriverML", "ActiveDriver", "DriverNet", "MutSigCV",
                  "OncoDriveFM", "DEG-Folchange", "DEG-p-value", "Hub-genes",
                  "SCS", "DawnRank", "pDriver")
colnames(r) <- c("Precision", "Recall", "F1Score")

# Set cancer type
cancer_type <- 4 # LUSC, column 4
#---------------------------------------

# PNC
# Set method
method <- 1 # PNC, sheet 1
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverML
# Set method
method <- 2 # DriverML, sheet 2
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# ActiveDriver
# Set method
method <- 3 # ActiveDriver, sheet 3
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverNet
# Set method
method <- 4 # DriverNet, sheet 4
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# MutSigCV
# Set method
method <- 5 # MutSigCV, sheet 5
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# OncoDriveFM
# Set method
method <- 6 # OncoDriveFM, sheet 6
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-Folchange
# Set method
method <- 7 # DEG-Folchange, sheet 7
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-p-value
# Set method
method <- 8 # DEG-p-value, sheet 8
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# # DEG-FDR
# # Set method
# method <- 9 # DEG-FDR, sheet 9
# # Evaluate
# driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
#                           sep = ""), sheet = method)
# driver <- driver[,cancer_type]
# driver_validated <- intersect(driver[[1]], gold_standard)
# t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
# ind <- ind + 1
# r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# Hub-genes
# Set method
method <- 10 # Hub-genes, sheet 10
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# SCS
# Set method
method <- 11 # SCS, sheet 11
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DawnRank
# Set method
method <- 12 # DawnRank, sheet 12
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# # SSN
# # Set method
# method <- 13 # SSN, sheet 13
# # Evaluate
# driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
#                           sep = ""), sheet = method)
# driver <- driver[,cancer_type]
# driver_validated <- intersect(driver[[1]], gold_standard)
# t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
# ind <- ind + 1
# r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# pDriver
driver <- read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
driver <- as.character(driver[,1])
driver_validated <- intersect(driver, gold_standard)
t <- computeMeasures(length(driver_validated), length(driver) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

```

## The script for KIRC

```{r, message=FALSE, warning=FALSE, eval=FALSE}
#=========================================================================
#=========================================================================
# pDriver: A novel method for unravelling personalised coding and non-coding cancer drivers
#=========================================================================
#=========================================================================
# Clear the environment
rm(list = ls())

# Load necessary libraries if any
library(readxl)
library(miRLAB)
library(miRBaseConverter)
library(ggplot2)
library(varhandle)
library(scales)
library(reshape)
library(plyr)
library(RColorBrewer)
library(tidyverse)
library(xtable)
library(arrangements)
library(biomaRt)
library(foreach)
library(doParallel)
library(pcalg)
library(ParallelPC)
library(CancerSubtypes)
library(survcomp)
library(Biobase)
library(mlr)
library(randomForestSRC)
library(Hmisc)
library(survival)
library(NMF)
library(cluster)
library(wesanderson)
library(lionessR)
library(data.table)
library(igraph)

#---------------------------------------
# Set environment variables if any
# Please remember to create necessary folders
rootDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment" # And put the input files
  # in "rootDir/Data"
outDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment/Data/KIRC" # Output folder
controlDir <- "C:/MinGW/bin" # Put here the library from control network
numCores <- 4 # Number of cores to be used
nomiR <- 100
nomR <- 100
#---------------------------------------

# Include the script of functions
source(paste(rootDir, "/Script/PersonalisedDriverFunctions.R", sep=""))
source(paste(rootDir, "/Script/Prognosis.R", sep=""))

# Main script
#================================================================
# (1) Constructing the miRNA-TF-mRNA network for cancer patients
#================================================================
#---------------------------------------
# Common
#---------------------------------------
# load the dataset
# Load the tumor expression data
#---------------------------------------
load(paste(rootDir, "/Data/KIRC_matchedData_full.RData", sep = "")) # rows - samples, cols - genes
matchedData <- KIRC_matchedData
#---------------------------------------

# Get PPI network
edges <- read_excel(paste(rootDir, "/Data/PPI.xls",
                          sep = ""), sheet = 1)
interactions <- edges[, c(1, 3)]
colnames(interactions) <- c("cause", "effect")
interactions <- interactions[which(interactions$cause %in% colnames(matchedData$mRNAs)),]
interactions <- interactions[which(interactions$effect %in% colnames(matchedData$mRNAs)),]
nodes <- unique(union(interactions$cause, interactions$effect))

# TFs: Download the list from http://fantom.gsc.riken.jp/5/sstar/Browse_Transcription_Factors_hg19
tfs <- read.csv(paste(rootDir, "/Data/Browse Transcription Factors hg19 - resource_browser.csv",
                      sep = ""))
i <- which(levels(tfs$Symbol) %in% nodes)
tfData <- matchedData$mRNAs[, levels(tfs$Symbol)[i]]

# Update cancer data of mRNAs
mRNAsData_Cancer <- matchedData$mRNAs[,
  nodes[which(!(nodes %in% levels(tfs$Symbol)[i]))]]

# Get the cancer data of miRNAs
miRNAsData_Cancer <-  matchedData$miRs

# Select genes
miRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(miRNAsData_Cancer), nomiR))
mRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(mRNAsData_Cancer),nomR))

# Covert miRNAs
colnames(miRNAsData_Cancer) <- miRNAVersionConvert(colnames(miRNAsData_Cancer),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]

# Combine data
noTF <- ncol(tfData)
cancer_data <- cbind(miRNAsData_Cancer, mRNAsData_Cancer, tfData)

# change to: rows - genes, cols - samples
cancer_data <- t(cancer_data)

# Free the memory
gc()

#---------------------------------------
# (1.1) LIONESS
#---------------------------------------
# construct network
cancer_network_LIONESS <- constructNetwork(cancer_data, method="LIONESS", rootDir)

# Save the network
fwrite(cancer_network_LIONESS, paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), row.names = FALSE)

#---------------------------------------
# Common (Just run 1 time)
#---------------------------------------
# Compute node weight
#---------------------------------------
load(paste(rootDir, "/Data/KIRC_matchedData_normal_samples_full.RData", sep = "")) # rows - samples, cols - genes
matchedData_normal_samples <- KIRC_matchedData_normal_samples
#---------------------------------------
miRNAsData_Normal <- matchedData_normal_samples$miRs
# Covert miRNAs
colnames(miRNAsData_Normal) <- miRNAVersionConvert(colnames(miRNAsData_Normal),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]
miRNAsData_Normal <-  miRNAsData_Normal[, colnames(miRNAsData_Cancer)]
mRNAsData_Normal <- matchedData_normal_samples$mRNAs[, colnames(mRNAsData_Cancer)]
tfData_Normal <- matchedData_normal_samples$mRNAs[, colnames(tfData)]
normal_data <- cbind(miRNAsData_Normal, mRNAsData_Normal, tfData_Normal)
nodeList <- computeNodeWeight(t(cancer_data), normal_data)
# Save file
write.csv(nodeList, paste(outDir, "/nodeList.csv", sep = ""), row.names = TRUE)

#================================================================
# (2) Identifying cancer drivers
#================================================================

#---------------------------------------
# (2.1) LIONESS - control
#---------------------------------------
network <- read.csv(paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), as.is = TRUE)
nodes <- read.csv(paste(outDir, "/nodeList.csv", sep = ""), as.is = TRUE)
drivers <- identifyDrivers(network, nodes, method="control", outDir, controlDir)
# Save drivers
drivers <- as.data.table(drivers)
fwrite(drivers, paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), row.names = FALSE)

#================================================================
# (3) Aggregate
#================================================================

#---------------------------------------
# (3.1) LIONESS - control
#---------------------------------------
drivers <- read.csv(paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), as.is = TRUE)
totalDrivers <- cbind(drivers[,1], 0)
totalDrivers[,2] <- rowSums(drivers[,2:ncol(drivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
noncodingDrivers <- totalDrivers[1:nomiR,]
noncodingDrivers <- noncodingDrivers[which(noncodingDrivers[,2] > 0),]
noncodingDrivers <- noncodingDrivers[order(noncodingDrivers[,2], decreasing = TRUE),]
codingDrivers <- totalDrivers[(nomiR+1):nrow(drivers),]
codingDrivers <- codingDrivers[which(codingDrivers[,2] > 0),]
codingDrivers <- codingDrivers[order(codingDrivers[,2], decreasing = TRUE),]
# Save drivers
noncodingDrivers <- as.data.table(noncodingDrivers)
fwrite(noncodingDrivers, paste(outDir, "/noncodingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)
codingDrivers <- as.data.table(codingDrivers)
fwrite(codingDrivers, paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)

#================================================================
# (4) Validate
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)

#---------------------------------------
# (4.1) LIONESS - control
#---------------------------------------
# pDriver
pDriver_drivers = read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
pDriver_Top50 <- pDriver_drivers[1:50,]
pDriver_Top100 <- pDriver_drivers[1:100,]
pDriver_Top150 <- pDriver_drivers[1:150,]
pDriver_Top200 <- pDriver_drivers[1:200,]
pDriver_Top50_Validated <- intersect(pDriver_Top50[, "V1"], gold_standard)
pDriver_Top100_Validated <- intersect(pDriver_Top100[, "V1"], gold_standard)
pDriver_Top150_Validated <- intersect(pDriver_Top150[, "V1"], gold_standard)
pDriver_Top200_Validated <- intersect(pDriver_Top200[, "V1"], gold_standard)

#================================================================
# (5) Compare
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)
noOfCGC <- length(gold_standard)

#---------------------------------------
# KIRC
#---------------------------------------
# Result
ind <- 0
#---------------------------------------
r <- matrix(0, nrow = 12, ncol = 3)
row.names(r) <- c("PNC", "DriverML", "ActiveDriver", "DriverNet", "MutSigCV",
                  "OncoDriveFM", "DEG-Folchange", "DEG-p-value", "Hub-genes",
                  "SCS", "DawnRank", "pDriver")
colnames(r) <- c("Precision", "Recall", "F1Score")

# Set cancer type
cancer_type <- 6 # KIRC, column 6
#---------------------------------------

# PNC
# Set method
method <- 1 # PNC, sheet 1
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverML
# Set method
method <- 2 # DriverML, sheet 2
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# ActiveDriver
# Set method
method <- 3 # ActiveDriver, sheet 3
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverNet
# Set method
method <- 4 # DriverNet, sheet 4
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# MutSigCV
# Set method
method <- 5 # MutSigCV, sheet 5
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# OncoDriveFM
# Set method
method <- 6 # OncoDriveFM, sheet 6
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-Folchange
# Set method
method <- 7 # DEG-Folchange, sheet 7
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-p-value
# Set method
method <- 8 # DEG-p-value, sheet 8
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# # DEG-FDR
# # Set method
# method <- 9 # DEG-FDR, sheet 9
# # Evaluate
# driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
#                           sep = ""), sheet = method)
# driver <- driver[,cancer_type]
# driver_validated <- intersect(driver[[1]], gold_standard)
# t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
# ind <- ind + 1
# r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# Hub-genes
# Set method
method <- 10 # Hub-genes, sheet 10
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# SCS
# Set method
method <- 11 # SCS, sheet 11
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DawnRank
# Set method
method <- 12 # DawnRank, sheet 12
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# # SSN
# # Set method
# method <- 13 # SSN, sheet 13
# # Evaluate
# driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
#                           sep = ""), sheet = method)
# driver <- driver[,cancer_type]
# driver_validated <- intersect(driver[[1]], gold_standard)
# t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
# ind <- ind + 1
# r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# pDriver
driver <- read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
driver <- as.character(driver[,1])
driver_validated <- intersect(driver, gold_standard)
t <- computeMeasures(length(driver_validated), length(driver) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

```

## The script for HNSC

```{r, message=FALSE, warning=FALSE, eval=FALSE}
#=========================================================================
#=========================================================================
# pDriver: A novel method for unravelling personalised coding and non-coding cancer drivers
#=========================================================================
#=========================================================================
# Clear the environment
rm(list = ls())

# Load necessary libraries if any
library(readxl)
library(miRLAB)
library(miRBaseConverter)
library(ggplot2)
library(varhandle)
library(scales)
library(reshape)
library(plyr)
library(RColorBrewer)
library(tidyverse)
library(xtable)
library(arrangements)
library(biomaRt)
library(foreach)
library(doParallel)
library(pcalg)
library(ParallelPC)
library(CancerSubtypes)
library(survcomp)
library(Biobase)
library(mlr)
library(randomForestSRC)
library(Hmisc)
library(survival)
library(NMF)
library(cluster)
library(wesanderson)
library(lionessR)
library(data.table)
library(igraph)

#---------------------------------------
# Set environment variables if any
# Please remember to create necessary folders
rootDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment" # And put the input files
  # in "rootDir/Data"
outDir <- "C:/Users/phavy022/MyDoc/19Personalised/Experiment/Data/HNSC" # Output folder
controlDir <- "C:/MinGW/bin" # Put here the library from control network
numCores <- 4 # Number of cores to be used
nomiR <- 100
nomR <- 100
#---------------------------------------

# Include the script of functions
source(paste(rootDir, "/Script/PersonalisedDriverFunctions.R", sep=""))
source(paste(rootDir, "/Script/Prognosis.R", sep=""))

# Main script
#================================================================
# (1) Constructing the miRNA-TF-mRNA network for cancer patients
#================================================================
#---------------------------------------
# Common
#---------------------------------------
# load the dataset
# Load the tumor expression data
#---------------------------------------
load(paste(rootDir, "/Data/HNSC_matchedData_full.RData", sep = "")) # rows - samples, cols - genes
matchedData <- HNSC_matchedData
#---------------------------------------

# Get PPI network
edges <- read_excel(paste(rootDir, "/Data/PPI.xls",
                          sep = ""), sheet = 1)
interactions <- edges[, c(1, 3)]
colnames(interactions) <- c("cause", "effect")
interactions <- interactions[which(interactions$cause %in% colnames(matchedData$mRNAs)),]
interactions <- interactions[which(interactions$effect %in% colnames(matchedData$mRNAs)),]
nodes <- unique(union(interactions$cause, interactions$effect))

# TFs: Download the list from http://fantom.gsc.riken.jp/5/sstar/Browse_Transcription_Factors_hg19
tfs <- read.csv(paste(rootDir, "/Data/Browse Transcription Factors hg19 - resource_browser.csv",
                      sep = ""))
i <- which(levels(tfs$Symbol) %in% nodes)
tfData <- matchedData$mRNAs[, levels(tfs$Symbol)[i]]

# Update cancer data of mRNAs
mRNAsData_Cancer <- matchedData$mRNAs[,
  nodes[which(!(nodes %in% levels(tfs$Symbol)[i]))]]

# Get the cancer data of miRNAs
miRNAsData_Cancer <-  matchedData$miRs

# Select genes
miRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(miRNAsData_Cancer), nomiR))
mRNAsData_Cancer <- t(selectVariablyExpressedGenes(t(mRNAsData_Cancer),nomR))

# Covert miRNAs
colnames(miRNAsData_Cancer) <- miRNAVersionConvert(colnames(miRNAsData_Cancer),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]

# Combine data
noTF <- ncol(tfData)
cancer_data <- cbind(miRNAsData_Cancer, mRNAsData_Cancer, tfData)

# change to: rows - genes, cols - samples
cancer_data <- t(cancer_data)

# Free the memory
gc()

#---------------------------------------
# (1.1) LIONESS
#---------------------------------------
# construct network
cancer_network_LIONESS <- constructNetwork(cancer_data, method="LIONESS", rootDir)

# Save the network
fwrite(cancer_network_LIONESS, paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), row.names = FALSE)

#---------------------------------------
# Common (Just run 1 time)
#---------------------------------------
# Compute node weight
#---------------------------------------
load(paste(rootDir, "/Data/HNSC_matchedData_normal_samples_full.RData", sep = "")) # rows - samples, cols - genes
matchedData_normal_samples <- HNSC_matchedData_normal_samples
#---------------------------------------
miRNAsData_Normal <- matchedData_normal_samples$miRs
# Covert miRNAs
colnames(miRNAsData_Normal) <- miRNAVersionConvert(colnames(miRNAsData_Normal),
                                                   targetVersion = "v21",
                                                   exact = TRUE,
                                                   verbose = FALSE)[,2]
miRNAsData_Normal <-  miRNAsData_Normal[, colnames(miRNAsData_Cancer)]
mRNAsData_Normal <- matchedData_normal_samples$mRNAs[, colnames(mRNAsData_Cancer)]
tfData_Normal <- matchedData_normal_samples$mRNAs[, colnames(tfData)]
normal_data <- cbind(miRNAsData_Normal, mRNAsData_Normal, tfData_Normal)
nodeList <- computeNodeWeight(t(cancer_data), normal_data)
# Save file
write.csv(nodeList, paste(outDir, "/nodeList.csv", sep = ""), row.names = TRUE)

#================================================================
# (2) Identifying cancer drivers
#================================================================

#---------------------------------------
# (2.1) LIONESS - control
#---------------------------------------
network <- read.csv(paste(outDir, "/cancer_network_LIONESS.csv", sep = ""), as.is = TRUE)
nodes <- read.csv(paste(outDir, "/nodeList.csv", sep = ""), as.is = TRUE)
drivers <- identifyDrivers(network, nodes, method="control", outDir, controlDir)
# Save drivers
drivers <- as.data.table(drivers)
fwrite(drivers, paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), row.names = FALSE)

#================================================================
# (3) Aggregate
#================================================================

#---------------------------------------
# (3.1) LIONESS - control
#---------------------------------------
drivers <- read.csv(paste(outDir, "/drivers_LIONESS_control.csv", sep = ""), as.is = TRUE)
totalDrivers <- cbind(drivers[,1], 0)
totalDrivers[,2] <- rowSums(drivers[,2:ncol(drivers)])
totalDrivers <- as.data.frame(totalDrivers)
totalDrivers[,1] <- as.character(totalDrivers[,1])
totalDrivers[,2] <- as.numeric(as.character(totalDrivers[,2]))
noncodingDrivers <- totalDrivers[1:nomiR,]
noncodingDrivers <- noncodingDrivers[which(noncodingDrivers[,2] > 0),]
noncodingDrivers <- noncodingDrivers[order(noncodingDrivers[,2], decreasing = TRUE),]
codingDrivers <- totalDrivers[(nomiR+1):nrow(drivers),]
codingDrivers <- codingDrivers[which(codingDrivers[,2] > 0),]
codingDrivers <- codingDrivers[order(codingDrivers[,2], decreasing = TRUE),]
# Save drivers
noncodingDrivers <- as.data.table(noncodingDrivers)
fwrite(noncodingDrivers, paste(outDir, "/noncodingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)
codingDrivers <- as.data.table(codingDrivers)
fwrite(codingDrivers, paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""),
       row.names = FALSE)

#================================================================
# (4) Validate
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)

#---------------------------------------
# (4.1) LIONESS - control
#---------------------------------------
# pDriver
pDriver_drivers = read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
pDriver_Top50 <- pDriver_drivers[1:50,]
pDriver_Top100 <- pDriver_drivers[1:100,]
pDriver_Top150 <- pDriver_drivers[1:150,]
pDriver_Top200 <- pDriver_drivers[1:200,]
pDriver_Top50_Validated <- intersect(pDriver_Top50[, "V1"], gold_standard)
pDriver_Top100_Validated <- intersect(pDriver_Top100[, "V1"], gold_standard)
pDriver_Top150_Validated <- intersect(pDriver_Top150[, "V1"], gold_standard)
pDriver_Top200_Validated <- intersect(pDriver_Top200[, "V1"], gold_standard)

#================================================================
# (5) Compare
#================================================================

#---------------------------------------
# Common
#---------------------------------------
# Load the gold standard, CGC
gold_standard = read.table(
  file = paste(rootDir, "/Data/Census_allFri Sep 28 07_39_37 2018.tsv", sep = ""),
  sep = '\t', header = TRUE)
gold_standard <- gold_standard[, 1]
gold_standard <- as.character(gold_standard)
noOfCGC <- length(gold_standard)

#---------------------------------------
# HNSC
#---------------------------------------
# Result
ind <- 0
#---------------------------------------
r <- matrix(0, nrow = 12, ncol = 3)
row.names(r) <- c("PNC", "DriverML", "ActiveDriver", "DriverNet", "MutSigCV",
                  "OncoDriveFM", "DEG-Folchange", "DEG-p-value", "Hub-genes",
                  "SCS", "DawnRank", "pDriver")
colnames(r) <- c("Precision", "Recall", "F1Score")

# Set cancer type
cancer_type <- 13 # HNSC, column 13
#---------------------------------------

# PNC
# Set method
method <- 1 # PNC, sheet 1
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverML
# Set method
method <- 2 # DriverML, sheet 2
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# ActiveDriver
# Set method
method <- 3 # ActiveDriver, sheet 3
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DriverNet
# Set method
method <- 4 # DriverNet, sheet 4
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(NA, NA, NA) # Because the number of estimated drivers is too small, we remove this out of the comparison

# MutSigCV
# Set method
method <- 5 # MutSigCV, sheet 5
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# OncoDriveFM
# Set method
method <- 6 # OncoDriveFM, sheet 6
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-Folchange
# Set method
method <- 7 # DEG-Folchange, sheet 7
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DEG-p-value
# Set method
method <- 8 # DEG-p-value, sheet 8
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# # DEG-FDR
# # Set method
# method <- 9 # DEG-FDR, sheet 9
# # Evaluate
# driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
#                           sep = ""), sheet = method)
# driver <- driver[,cancer_type]
# driver_validated <- intersect(driver[[1]], gold_standard)
# t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
# ind <- ind + 1
# r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# Hub-genes
# Set method
method <- 10 # Hub-genes, sheet 10
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# SCS
# Set method
method <- 11 # SCS, sheet 11
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# DawnRank
# Set method
method <- 12 # DawnRank, sheet 12
# Evaluate
driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
                          sep = ""), sheet = method)
# driver <- driver[,cancer_type]
driver <- driver[!is.na(driver[,cancer_type]),cancer_type]
driver_validated <- intersect(driver[[1]], gold_standard)
t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# # SSN
# # Set method
# method <- 13 # SSN, sheet 13
# # Evaluate
# driver <- read_excel(paste(rootDir, "/Data/journal.pcbi.1007520.s004.xlsx",
#                           sep = ""), sheet = method)
# driver <- driver[,cancer_type]
# driver_validated <- intersect(driver[[1]], gold_standard)
# t <- computeMeasures(length(driver_validated), length(driver[[1]]) - length(driver_validated), noOfCGC)
# ind <- ind + 1
# r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

# pDriver
driver <- read.csv(
  file = paste(outDir, "/codingGeneralDrivers_LIONESS_control.csv", sep = ""))
driver <- as.character(driver[,1])
driver_validated <- intersect(driver, gold_standard)
t <- computeMeasures(length(driver_validated), length(driver) - length(driver_validated), noOfCGC)
ind <- ind + 1
r[ind,] <- c(t$Precision, t$Recall, t$F1Score)

```
